<dashboard script="st_lookup_gen.js" theme="dark" version="1.1">
  <label>Sourcetypes Analysis</label>
  <description>Monitor and analyze data source health</description>
  <!-- Status Message Panel -->
  <!-- Show State Message Panel -->
  <!-- All Sourcetypes Stats -->
  <!-- Critical Sources (No Data in 30 mins) -->
  <fieldset submitButton="false">
    <html>
    <!-- First Button -->
    <button id="refresh-lookup-btn" class="btn btn-primary" style="margin: 10px;">
      <i class="icon-rotate-counter"/> Refresh Datasource Inventory - Use This For Current Inventory
    </button>
    
    <!-- Second Button -->
    <button id="refresh-sourcetype-btn" class="btn btn-primary" style="margin: 10px;">
      <i class="icon-rotate-counter"/> Refresh Sourcetype State Run Once Only To Create State Lookup
    </button>
  </html>
  </fieldset>
  <row>
    <panel>
      <html>
        <div id="status-message" style="padding: 10px; margin: 10px; border-radius: 5px; display: none;">
          <span id="status-text"/>
        </div>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <div id="sourcetype-status-message" style="padding: 10px; margin: 10px; border-radius: 5px; display: none;">
          <span id="sourcetype-status-text"/>
        </div>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>All Sourcetypes Inventory</title>
      <table>
        <search>
          <query>
		  | inputlookup iops_st_inv
		  | sort - count
          </query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Critical: No Data in Last 60 Minutes</title>
      <table>
        <search>
          <query>| tstats count WHERE index=* earliest=-60m latest=now BY sourcetype
| eval state="exists"
| append
    [| inputlookup iops_st_state
    | eval state="missing"]
| dedup sourcetype
| search state="missing"</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="age_minutes">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#F1813F"></colorPalette>
        </format>
      </table>
    </panel>
  </row>
</dashboard>